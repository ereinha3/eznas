






services:

  traefik:
    image: traefik:v3.1
    container_name: traefik
    restart: unless-stopped
    command:
      - "--providers.docker=true"
      - "--providers.docker.exposedbydefault=false"
      - "--providers.file.directory=/config"
      - "--providers.file.watch=true"
      - "--entrypoints.web.address=:80"

      - "--entrypoints.websecure.address=:443"


      - "--api.dashboard=true"
      - "--api.insecure=true"


    ports:
      - "80:80"

      - "8001:443"

    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - /home/ethan/eznas/test_appdata/traefik:/config
    networks:
      - nas_net


  qbittorrent:
    image: lscr.io/linuxserver/qbittorrent:latest
    container_name: qbittorrent
    restart: unless-stopped
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=UTC
    volumes:
      - /home/ethan/eznas/test_appdata/qbittorrent:/config
      - /mnt/pool/media:/downloads
      - /mnt/pool:/data

    ports:
      - "8077:8080"


    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.qbittorrent.rule=Host(`torrent.home.lab`)"
      - "traefik.http.routers.qbittorrent.entrypoints=websecure"

      - "traefik.http.routers.qbittorrent.tls=true"

      - "traefik.http.services.qbittorrent.loadbalancer.server.port=8080"

    networks:
      - nas_net



  radarr:
    image: lscr.io/linuxserver/radarr:latest
    container_name: radarr
    restart: unless-stopped
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=UTC
    volumes:
      - /home/ethan/eznas/test_appdata/radarr:/config
      - /mnt/pool:/data
      - /mnt/pool/media:/scratch

    ports:
      - "7878:7878"


    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.radarr.rule=Host(`radarr.home.lab`)"
      - "traefik.http.routers.radarr.entrypoints=websecure"

      - "traefik.http.routers.radarr.tls=true"

      - "traefik.http.services.radarr.loadbalancer.server.port=7878"

    depends_on:

      - qbittorrent

    networks:
      - nas_net



  sonarr:
    image: lscr.io/linuxserver/sonarr:latest
    container_name: sonarr
    restart: unless-stopped
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=UTC
    volumes:
      - /home/ethan/eznas/test_appdata/sonarr:/config
      - /mnt/pool:/data
      - /mnt/pool/media:/scratch

    ports:
      - "8989:8989"


    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.sonarr.rule=Host(`sonarr.home.lab`)"
      - "traefik.http.routers.sonarr.entrypoints=websecure"

      - "traefik.http.routers.sonarr.tls=true"

      - "traefik.http.services.sonarr.loadbalancer.server.port=8989"

    depends_on:

      - qbittorrent

    networks:
      - nas_net



  prowlarr:
    image: lscr.io/linuxserver/prowlarr:latest
    container_name: prowlarr
    restart: unless-stopped
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=UTC
    volumes:
      - /home/ethan/eznas/test_appdata/prowlarr:/config

    ports:
      - "9696:9696"


    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.prowlarr.rule=Host(`prowlarr.home.lab`)"
      - "traefik.http.routers.prowlarr.entrypoints=websecure"

      - "traefik.http.routers.prowlarr.tls=true"

      - "traefik.http.services.prowlarr.loadbalancer.server.port=9696"

    networks:
      - nas_net



  jellyseerr:
    image: fallenbagel/jellyseerr:latest
    container_name: jellyseerr
    restart: unless-stopped
    environment:
      - LOG_LEVEL=info
      - TZ=UTC
    volumes:
      - /home/ethan/eznas/test_appdata/jellyseerr:/app/config

    ports:
      - "5055:5055"


    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.jellyseerr.rule=Host(`jellyseer.home.lab`)"
      - "traefik.http.routers.jellyseerr.entrypoints=websecure"

      - "traefik.http.routers.jellyseerr.tls=true"

      - "traefik.http.services.jellyseerr.loadbalancer.server.port=5055"

    depends_on:

      - radarr


      - sonarr


      - jellyfin

    networks:
      - nas_net



  jellyfin:
    image: lscr.io/linuxserver/jellyfin:latest
    container_name: jellyfin
    restart: unless-stopped
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=UTC
    volumes:
      - /home/ethan/eznas/test_appdata/jellyfin:/config
      - /mnt/pool/media/transcode:/transcode
      - /mnt/pool:/data

    ports:
      - "8098:8096"


    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.jellyfin.rule=Host(`jellyfin.home.lab`)"
      - "traefik.http.routers.jellyfin.entrypoints=websecure"

      - "traefik.http.routers.jellyfin.tls=true"

      - "traefik.http.services.jellyfin.loadbalancer.server.port=8096"

    networks:
      - nas_net



  pipeline-worker:
    build:
      context: ..
      dockerfile: Dockerfile
    container_name: pipeline-worker
    restart: unless-stopped
    environment:
      - TZ=UTC
      - ORCH_ROOT=/config
      - PIPELINE_INTERVAL=60
    command: ["python", "-m", "orchestrator.pipeline.runner"]
    volumes:
      - /mnt/pool:/data
      # Match qBittorrent's internal save paths (it reports /downloads/... via API).
      - /mnt/pool/media:/downloads
      - /mnt/pool/media:/scratch
      # Mount config directory for stack.yaml and state.json
      - /home/ethan/eznas/nas_orchestrator:/config
    depends_on:

      - qbittorrent

    networks:
      - nas_net


networks:
  nas_net:
    driver: bridge