# Development Dockerfile - optimized for fast rebuilds and live reload
FROM python:3.12-slim

ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1

WORKDIR /app

# Install system dependencies
RUN apt-get update \
    && apt-get install -y --no-install-recommends \
        docker.io \
        openssl \
        ca-certificates \
        ffmpeg \
    && rm -rf /var/lib/apt/lists/*

# Install Python dependencies first (cached layer)
COPY pyproject.toml README.md ./
RUN pip install --no-cache-dir -e .

# Copy templates (less frequently changed)
COPY templates/ ./templates/

# Source code is mounted as volume, not copied
# This enables live reload without rebuilding

EXPOSE 8443

# Default: run uvicorn with auto-reload
CMD ["uvicorn", "orchestrator.app:app", "--host", "0.0.0.0", "--port", "8443", "--reload", "--reload-dir", "/app/orchestrator"]
